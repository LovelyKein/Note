# å®¢æˆ·ç«¯&æœåŠ¡å™¨

åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œé€šä¿¡æ€»æ˜¯ç”±ä¸€æ–¹å‘å‡ºä¸€ä¸ªæ¶ˆæ¯å¼€å§‹ï¼Œè€Œå¦ä¸€æ–¹å›å¤ä¸€ä¸ªæ¶ˆæ¯ç»“æŸ
å‘å‡ºæ¶ˆæ¯çš„ä¸€æ–¹ç§°ä¹‹ä¸º**å®¢æˆ·ç«¯**`Client`ï¼Œå‘å‡ºæ¶ˆæ¯çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºè¯·æ±‚`Request`
å›å¤æ¶ˆæ¯çš„ä¸€æ–¹ç§°ä¹‹ä¸º**æœåŠ¡å™¨**`Server`ï¼Œå›å¤æ¶ˆæ¯çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºå“åº”`Response`

![image-20250614153552168](./assets/image-20250614153552168.png)

> [!NOTE]
>
> **ä¸ç®¡æ˜¯å®¢æˆ·ç«¯ï¼Œè¿˜æ˜¯æœåŠ¡å™¨ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯ä¸€å°è®¡ç®—æœº**
> **å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„è®¡ç®—æœºä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨åŒä¸€å°è®¡ç®—æœºä¸Š**
> ä¾‹å¦‚`liveserver`æ’ä»¶å’Œ`http.createServer`ï¼Œå°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå®ƒè¿è¡Œåœ¨æœ¬åœ°çš„è®¡ç®—æœºä¸Š
>
> å¤§éƒ¨åˆ†åç«¯å¼€å‘çš„å°±æ˜¯æœåŠ¡å™¨ç¨‹åºï¼Œå‰ç«¯çš„`NodeJs`æŠ€æœ¯ä¹Ÿèƒ½å¼€å‘æœåŠ¡å™¨ç¨‹åº
>
> å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¿™ç§äº¤äº’æ¨¡å¼ç§°ä¹‹ä¸ºã€Œç»å…¸C/Sç»“æ„ã€ï¼Œå¦‚æœå®¢æˆ·ç«¯æ˜¯æµè§ˆå™¨åˆ™ç§°ä¹‹ä¸ºã€ŒB/Sç»“æ„ã€
>
> æœåŠ¡å™¨ç¨‹åºå¾€å¾€æ˜¯ä¸ºäº’è”ç½‘äº§å“æä¾›æœåŠ¡ï¼Œå› æ­¤åˆç§°ä¹‹ä¸º`web`æœåŠ¡å™¨
>
> **ä¸€æ¬¡å®Œæ•´çš„äº¤äº’ï¼Œæ€»æ˜¯ä»è¯·æ±‚å¼€å§‹ï¼Œå“åº”ç»“æŸ**



# åœ°å€`url`

åœ¨äº’è”ç½‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªå«`url`åœ°å€çš„ä¸œè¥¿æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„èµ„æº
`url`å…¨ç§°`uniform resource locator`ï¼Œ**ç»Ÿä¸€èµ„æºå®šä½ç¬¦**
å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºè¡¨è¾¾äº’è”ç½‘ä¸­æŸä¸ªèµ„æºçš„ä½ç½®

![image-20250614162350029](./assets/image-20250614162350029.png)



## åè®®`protocol`

### `http`

é€šè¿‡urlåœ°å€ï¼Œèƒ½å¤Ÿåœ¨èŒ«èŒ«äº’è”ç½‘ä¸­å‡†ç¡®çš„æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„æœåŠ¡
ä½†å…‰æ‰¾åˆ°æœåŠ¡è¿˜æ˜¯ä¸å¤Ÿï¼ŒåŒæ–¹éœ€è¦ã€Œç”¨åŒä¸€ç§è¯­è¨€ã€æ¥å¯¹è¯ï¼Œå¦åˆ™éƒ½å¬ä¸æ‡‚å¯¹æ–¹åœ¨è¯´ä»€ä¹ˆ
è¿™ä¸ªã€Œè¯­è¨€ã€å°±æ˜¯åè®®ï¼Œè€Œäº’è”ç½‘ä¸­æœ€å¸¸è§çš„åè®®å°±æ˜¯`http`åè®®
`http`æ˜¯åŸºäºã€Œè¯·æ±‚-å“åº”ã€çš„æ–¹å¼å®Œæˆé€šä¿¡çš„ï¼Œæ¯ä¸€æ¬¡é€šä¿¡éƒ½æ˜¯ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œä¼ é€’ä¸€äº›æ¶ˆæ¯è¿‡å»ï¼Œç„¶åç»è¿‡æœåŠ¡å™¨ç¨‹åºå¤„ç†åï¼Œå“åº”ç»™å®¢æˆ·ç«¯ä¸€äº›æ¶ˆæ¯
åè®®è§„å®šï¼š

- æ¯æ¬¡ã€Œè¯·æ±‚-å“åº”ã€éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç›¸äº’ä¹‹é—´äº’ä¸å¹²æ‰°ï¼Œè¿™ç§æ¨¡å¼çš„åè®®æˆ‘ä»¬ç§°ä¹‹ä¸º**æ— çŠ¶æ€åè®®**
- **æ¯æ¬¡ã€Œè¯·æ±‚-å“åº”ã€ä¼ é€’çš„æ¶ˆæ¯éƒ½æ˜¯çº¯æ–‡æœ¬(å­—ç¬¦ä¸²)**ï¼Œè€Œä¸”ä¸”æ–‡æœ¬æ ¼å¼å¿…é¡»æŒ‰ç…§httpåè®®è§„å®šçš„æ ¼å¼ä¹¦å†™

### `https`

`https`æ˜¯åœ¨`http`åè®®åŸºç¡€ä¸Šå‘å±•èµ·æ¥çš„ï¼Œå®ƒå¢åŠ äº†å®‰å…¨æ€§ï¼Œéƒ½åŸºäº`TCP`åè®®
å®ƒä¿è¯äº†æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«çªƒå–å’Œç¯¡æ”¹ï¼Œä»è€Œä¿è¯ä¼ è¾“å®‰å…¨

æœåŠ¡å™¨ç”³è¯·`SSL`åŠ å¯†åè®®è¯ä¹¦ï¼Œæµè§ˆå™¨é€šè¿‡`https`åè®®è®¿é—®æœåŠ¡ï¼Œå…ˆä¼šæ‹¿åˆ°è¯ä¹¦ç­¾åå†éªŒè¯æ˜¯å¦è¢«ç¯¡æ”¹ï¼ŒéªŒè¯æ— è¯¯åˆ™ååˆ™æ­£å¸¸é€šä¿¡

![image-20250729161244507](./assets/image-20250729161244507.png)



## ä¸»æœº`Host`

å®ƒè¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›åœ¨å“ªå°è®¡ç®—æœºä¸Šå¯»æ‰¾èµ„æºï¼Œæœ‰ä¸¤ç§å†™æ³•ï¼š`IP`åœ°å€å’ŒåŸŸå

### `IP`åœ°å€

ç”±å››éƒ¨åˆ†æ•°å­—ç»„æˆï¼Œæ¯éƒ¨åˆ†æ•°å­—å¯¹åº”8ä½äºŒè¿›åˆ¶æ•°å­—ï¼Œå„éƒ¨åˆ†ä¹‹é—´ç”¨å°æ•°ç‚¹åˆ†å¼€ï¼Œå¦‚ï¼š`211.152.65.112`
ç½‘ç»œä¸Šçš„æ¯å°ä¸»æœºéƒ½åˆ†é…äº†ä¸€ä¸ªä¸“é—¨çš„åœ°å€ï¼Œæ˜¯å”¯ä¸€çš„

ç‰¹æ®Š`IP`åœ°å€ï¼Œ`127.0.0.1`å®ƒè¡¨ç¤ºæœ¬æœº`IP`åœ°å€

### åŸŸå

åŸŸåç±»ä¼¼`IP`åœ°å€çš„åˆ«åï¼ŒæŠŠä¸å®¹æ˜“è®°å¿†çš„æ•°å­—è¦ä¸ºå®¹æ˜“è®°å¿†çš„å•è¯
**å½“ä½¿ç”¨åŸŸåè®¿é—®æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸º`IP`åœ°å€**
ç‰¹æ®ŠåŸŸå`localhost`ï¼Œå®ƒè¡¨ç¤ºçš„`IP`åœ°å€æ˜¯`127.0.0.1`



## ç«¯å£`Port`

å®ƒè¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›åœ¨å“ªä¸ªåº”ç”¨ç¨‹åºä¸­å¯»æ‰¾èµ„æºï¼Œæ‰€æœ‰ç½‘ç»œé€šä¿¡çš„åº”ç”¨ç¨‹åºéƒ½å¿…é¡»è¦å æœ‰ä¸€ä¸ªç«¯å£å·
æ¯ä¸ªæœåŠ¡å™¨ç¨‹åºï¼Œéƒ½ä¼šç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªç«¯å£ï¼Œåªæœ‰æ‰¾åˆ°å¯¹åº”çš„ç«¯å£ï¼Œæ‰èƒ½æ‰¾åˆ°è¿™ä¸ªç¨‹åº
ç«¯å£å·çš„èŒƒå›´åœ¨`0 ï½ 65535`ï¼Œç«¯å£å·æ˜¯å¯é€‰çš„ï¼Œè‹¥ä¸å¡«å†™ï¼Œåˆ™ï¼š

- å¦‚æœä½¿ç”¨çš„æ˜¯`http`åè®®ï¼Œé»˜è®¤ç«¯å£å·ä¸º`80`
- å¦‚æœä½¿ç”¨çš„æ˜¯`https`åè®®ï¼Œé»˜è®¤ç«¯å£å·ä¸º`443`



## è·¯å¾„`Path`

æœåŠ¡å™¨ä¸Šå¾€å¾€æœ‰è®¸è®¸å¤šå¤šçš„èµ„æºï¼Œæ¯ä¸ªèµ„æºéƒ½æœ‰è‡ªå·±çš„è®¿é—®è·¯å¾„
è·¯å¾„æ˜¯å¯é€‰çš„ï¼Œè‹¥ä¸å†™ï¼Œåˆ™ä¸º`/`



## å‚æ•°`Query/Params`

æŸäº›èµ„æºå¯ä»¥æ ¹æ®éœ€è¦å‘ˆç°ä¸åŒçš„å†…å®¹ï¼Œæ¯”å¦‚ä¸€ç¯‡æ–°é—»åˆ—è¡¨çš„é¡µé¢ï¼Œå¯ä»¥æŒ‡å®šå®ƒå‘ˆç°ç¬¬å‡ é¡µçš„æ–°é—»
è€Œã€Œç¬¬å‡ é¡µã€å°±å±äºä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œè¿™äº›é¢å¤–ä¿¡æ¯å¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’

```js
// æŸ¥è¯¢å‚æ•°(Query)ï¼špage=1&limit=10
const url = 'http://duyiedu.com/news?page=1&limit=10'

// è·¯å¾„å‚æ•°(Url Params)ï¼š34767253ï¼ŒæœåŠ¡å™¨ä¸­è·¯ç”±åŒ¹é…è§„åˆ™ä¸ºï¼š`/news/:id`
const url = 'http://duyiedu.com/news/34767253'
```



## `hash`

åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œ`hash`æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå®ƒå¾€å¾€ä½œä¸ºæµè§ˆå™¨çš„é”šé“¾æ¥å‡ºç°



## è¯·æ±‚çš„æ¶ˆæ¯æ ¼å¼

è¯·æ±‚æ¶ˆæ¯æ ¼å¼æœ‰ä¸‰éƒ¨åˆ†ç»„æˆ

![image-20250614175125788](./assets/image-20250614175125788.png)

### è¯·æ±‚è¡Œ

é«˜åº¦æ¦‚æ‹¬äº†å®¢æˆ·ç«¯æƒ³è¦å¹²ä»€ä¹ˆ
è¯·æ±‚è¡Œæ˜¯æ•´ä¸ªhttpæŠ¥æ–‡çš„ç¬¬ä¸€è¡Œå­—ç¬¦ä¸²ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š**è¯·æ±‚æ–¹æ³•ã€è·¯å¾„+å‚æ•°+hashã€åè®®å’Œç‰ˆæœ¬**

è¯·æ±‚æ–¹æ³•ï¼šæ˜¯ä¸€ä¸ªå•è¯ï¼Œå®ƒè¡¨è¾¾äº†å®¢æˆ·ç«¯çš„ã€ŒåŠ¨ä½œã€ï¼Œæ¯”å¦‚ï¼š`GET`è·å–ã€`POST`æäº¤
**åœ¨httpåè®®ä¸­ï¼Œæ²¡æœ‰è§„å®šåªèƒ½ä½¿ç”¨ä¸Šé¢ä¸¤ç§åŠ¨ä½œï¼Œç”šè‡³æ²¡æœ‰è§„å®šæ¯ç§åŠ¨ä½œä¼šå¸¦æ¥æ€æ ·çš„å˜åŒ–ï¼Œåªæœ‰è¯­ä¹‰ä¸Šçš„å·®åˆ«**
è€Œåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€æ¸æœ‰äº†ä¸€äº›çº¦å®šä¿—æˆçš„è§„èŒƒï¼š

1. åŠ¨ä½œé€šå¸¸æœ‰ï¼šGET(è·å–èµ„æº)ã€POST(æäº¤æ¶ˆæ¯)ã€PUT(ä¿®æ”¹æ•°æ®)ã€DELETE(åˆ é™¤æ•°æ®)
2. **`GET`å’Œ`DELETE`è¯·æ±‚ä½“ä¸ºç©ºï¼Œè€Œ`POST`å’Œ`PUT`è¯·æ±‚å¯ä»¥æœ‰è¯·æ±‚ä½“**

> [!IMPORTANT]
>
> æµè§ˆå™¨éµå¾ªäº†ä¸Šé¢çš„è§„èŒƒï¼Œè¿™å¸¦æ¥äº†`GET`å’Œ`POST`çš„è¯¸å¤šåŒºåˆ«
> æ¯”å¦‚ï¼Œ**ç”±äº`GET`è¯·æ±‚ä½“ä¸ºç©ºï¼Œæ‰€ä»¥è¦ä¼ é€’æ•°æ®åªèƒ½æŠŠæ•°æ®æ”¾åˆ°urlçš„å‚æ•°ä¸­**
> ä¾‹å¦‚`http://www.xxx.com/news?page=1&size=10`ä¸­ï¼Œ`page=1&size=10`å°±æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°
>
> **`GET`è¯·æ±‚ä½“ä¸ºç©ºï¼Œä½†ä¸èƒ½æ²¡æœ‰**
> å³è¯·æ±‚å¤´åå¿…é¡»è¦æœ‰ä¸¤ä¸ªæ¢è¡Œï¼Œå¦ä¾§è¯·æ±‚æ˜¯ä¸å®Œæ•´çš„ï¼Œå†åé¢æ‰æ˜¯è¯·æ±‚ä½“ï¼Œè¯·æ±‚ä½“ä¸ºç©ºå¯ä»¥ä¸å†™
>
> ```js
> è¯·æ±‚è¡Œ
> è¯·æ±‚å¤´
> 
> è¯·æ±‚ä½“
> ```

åœ¨æµè§ˆå™¨ä¸­ï¼Œè·å–æ•°æ®ä¸€èˆ¬ä½¿ç”¨çš„éƒ½æ˜¯`GET`è¯·æ±‚ï¼Œæ¯”å¦‚ï¼š

- åœ¨åœ°å€æ è¾“å…¥åœ°å€å¹¶æŒ‰ä¸‹å›è½¦
- ç‚¹å‡»äº†æŸä¸ªaå…ƒç´ 
- è·å–å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘
- è·å–cssã€jsã€å­—ä½“ç­‰æ–‡ä»¶

äº‹å®ä¸Šï¼Œæµè§ˆå™¨è‡ªåŠ¨å‘å‡ºçš„è¯·æ±‚åŸºæœ¬éƒ½æ˜¯`GET`è¯·æ±‚
è€Œ`POST`è¯·æ±‚éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¤„ç†ï¼Œæ¯”å¦‚åœ¨formè¡¨å•ä¸­è®¾ç½®methodä¸º`POST`

### è¯·æ±‚å¤´

æè¿°äº†è¯·æ±‚çš„ä¸€äº›é¢å¤–ä¿¡æ¯
**è¯·æ±‚å¤´æ˜¯ä¸€ç³»åˆ—çš„é”®å€¼å¯¹**ï¼Œé‡Œé¢åŒ…å«äº†è¯¸å¤šå’Œä¸šåŠ¡æ— å…³çš„ä¿¡æ¯
æµè§ˆå™¨æ¯æ¬¡è¯·æ±‚æœåŠ¡å™¨éƒ½ä¼šè‡ªåŠ¨é™„å¸¦å¾ˆå¤šçš„è¯·æ±‚å¤´ï¼Œå…¶å®è¿™äº›è¯·æ±‚å¤´å¤§éƒ¨åˆ†æœåŠ¡å™¨æ˜¯ä¸éœ€è¦çš„

- `host`ï¼šurlåœ°å€ä¸­çš„ä¸»æœº

- `User-Agent`ï¼šå®¢æˆ·ç«¯çš„ä¿¡æ¯æè¿°

- `Content-Type`ï¼šè¯·æ±‚ä½“çš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆæ ¼å¼ï¼Œ**å¦‚æœæ²¡æœ‰è¯·æ±‚ä½“ï¼Œè¿™ä¸ªå­—æ®µæ— æ„ä¹‰**
  è¯¥å­—æ®µçš„å¸¸è§å–å€¼ä¸ºï¼š

  1. `application/x-www-form-urlencoded`
     è¡¨ç¤ºè¯·æ±‚ä½“çš„æ•°æ®æ ¼å¼å’Œurlåœ°å€ä¸­å‚æ•°çš„æ ¼å¼ç±»ä¼¼

     ```js
     loginId=admin%loginPwd=123123
     ```

  2. `applocation/json`
     æ ‡è¯†è¯·æ±‚ä½“çš„æ•°æ®æ ¼å¼æ˜¯`json`æ ¼å¼

     ```json
     { "loginId": "admin", "loginPwd": "123123" }
     ```

  3. `multipart/form-data`
     ç§ç‰¹æ®Šçš„è¯·æ±‚ä½“æ ¼å¼ï¼Œä¸Šä¼ æ–‡ä»¶ä¸€èˆ¬é€‰æ‹©è¯¥æ ¼å¼

### è¯·æ±‚ä½“

åŒ…å«äº†è¦ç»™æœåŠ¡å™¨ä¼ é€’çš„æ­£æ–‡æ•°æ®ï¼Œè¯·æ±‚ä½“æ˜¯å¯ä»¥çœç•¥çš„
ç†è®ºä¸Šï¼Œè¯·æ±‚ä½“å¯ä»¥æ˜¯ä»»æ„æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½†ä¹ æƒ¯ä¸Šï¼ŒæœåŠ¡å™¨æ™®éèƒ½è¯†åˆ«ä»¥ä¸‹å‡ ç§æ ¼å¼ï¼š

```js
`application/x-www-form-urlencoded`
`applocation/json`
`multipart/form-data`
```

ç”±äºè¯·æ±‚ä½“æ ¼å¼çš„å¤šæ ·æ€§ï¼ŒæœåŠ¡å™¨åœ¨åˆ†æè¯·æ±‚ä½“æ—¶å¯èƒ½æ— æ³•çŸ¥æ™“å…·ä½“çš„æ ¼å¼ï¼Œä»è€Œä¸çŸ¥é“å¦‚ä½•è§£æè¯·æ±‚ä½“
å› æ­¤ï¼Œ**æœåŠ¡å™¨å¾€å¾€è¦æ±‚åœ¨è¯·æ±‚å¤´ä¸­é™„å¸¦ä¸€ä¸ªå±æ€§`Content-Type`æ¥æè¿°è¯·æ±‚ä½“ä½¿ç”¨çš„æ ¼å¼**

> [!IMPORTANT]
>
> **è¯·æ±‚ä½“ä¸­æ•°æ®çš„æ ¼å¼ï¼Œè¦ä¸è¯·æ±‚å¤´ä¸­çš„`Content-Type`çš„æ ¼å¼ä¿æŒä¸€è‡´**



## å“åº”çš„æ¶ˆæ¯æ ¼å¼

![image-20250617193647326](./assets/image-20250617193647326.png)

### å“åº”è¡Œ

å“åº”è¡Œæ˜¯æ•´ä¸ªå“åº”å­—ç¬¦ä¸²çš„ç¬¬ä¸€è¡Œ
å“åº”è¡ŒåŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š

- **åè®®ç‰ˆæœ¬**ï¼šè¡¨ç¤ºæœåŠ¡å™¨æ‰“ç®—å’Œå®¢æˆ·ç«¯ç”¨ä»€ä¹ˆåè®®é€šä¿¡
- **çŠ¶æ€ç ï¼ˆçŠ¶æ€æ¶ˆæ¯ï¼‰**ï¼šè¡¨ç¤ºæœåŠ¡å™¨å¯¹å½“å‰è¯·æ±‚çš„è¡¨æ€

é€šå¸¸ï¼ŒçŠ¶æ€ç å’ŒçŠ¶æ€æ¶ˆæ¯æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ¯”å¦‚çŠ¶æ€ç 200çš„æ¶ˆæ¯å°±æ˜¯OK
ä¸åŒçš„è¯·æ±‚å¯èƒ½ä¼šå¾—åˆ°ä¸åŒçš„çŠ¶æ€ç ï¼Œè‡³äºåˆ°åº•ä¼šå¾—åˆ°å“ªä¸ªçŠ¶æ€ç ï¼Œç”±åç«¯ç¨‹åºå†³å®š
çŠ¶æ€ç åˆ†ä¸ºäº”ç±»ï¼š

| åˆ†ç±» | åˆ†ç±»æè¿°                                       |
| ---- | ---------------------------------------------- |
| 1**  | ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ   |
| 2**  | æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†                     |
| 3**  | é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚             |
| 4**  | å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚     |
| 5**  | æœåŠ¡ç«¯é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ |

é€šå¸¸è®¤ä¸ºï¼Œ0 ~ 399ä¹‹é—´çš„çŠ¶æ€ç éƒ½æ˜¯æ­£å¸¸çš„ï¼Œå…¶ä»–ä¸ºä¸æ­£å¸¸
å¸¸è§çš„çŠ¶æ€ç æœ‰ï¼š

1. `200 OK`ï¼šä¸€åˆ‡æ­£å¸¸
2. `301 Moved Permanently`ï¼šèµ„æºå·²è¢«æ°¸ä¹…é‡å®šå‘
   è¯·æ±‚å·²æ”¶åˆ°ï¼Œä½†æ˜¯éœ€è¦çš„èµ„æºä¸åœ¨è¿™ä¸ªåœ°å€ï¼Œè¢«æ°¸è¿œåœ°ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„è®¿é—®åœ°å€
   **éœ€è¦å»è¯·æ±‚æ–°çš„åœ°å€ï¼Œæ–°åœ°å€æ”¾åˆ°è¯·æ±‚å¤´çš„`Location`ä¸­**
3. `302 Found`ï¼šèµ„æºè¢«æš‚æ—¶é‡å®šå‘
   è¯·æ±‚å·²æ”¶åˆ°ï¼Œä½†æ˜¯éœ€è¦çš„èµ„æºä¸åœ¨è¿™ä¸ªåœ°å€ï¼Œè¢«æš‚æ—¶åœ°ç§»åŠ¨åˆ°äº†ä¸€ä¸ªæ–°çš„åœ°å€
   **éœ€è¦å»è¯·æ±‚æ–°çš„åœ°å€ï¼Œæ–°åœ°å€æ”¾åˆ°è¯·æ±‚å¤´çš„`Location`ä¸­**
4. `304 Not Modified`ï¼šæ–‡æ¡£å†…å®¹æœªè¢«ä¿®æ”¹ï¼ˆç¼“å­˜ï¼‰
   è¯·æ±‚å·²æ”¶åˆ°ï¼Œè¯·æ±‚çš„èµ„æºå†…å®¹å’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œç”¨ä¹‹å‰è¯·æ±‚çš„ç»“æœ
5. `400 Bad Resuest`ï¼šè¯­ä¹‰é”™è¯¯ï¼Œå½“å‰è¯·æ±‚æœåŠ¡ç«¯æ— æ³•ç†è§£å’Œå¤„ç†
6. `403 Forbidden`ï¼šæœåŠ¡å™¨æ‹’ç»æ‰§è¡Œï¼Œä¸€èˆ¬ç†è§£ä¸ºæ²¡æœ‰æƒé™
7. `404 Not Found`ï¼šè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ï¼Œä¸€èˆ¬æ˜¯è¯·æ±‚è·¯å¾„é”™è¯¯
8. `500 Internal Server Error`ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### å“åº”å¤´

å’Œè¯·æ±‚å¤´ä¸€æ ·ï¼Œå“åº”å¤´ä¹Ÿæ˜¯ç”±å¾ˆå¤šä¸ªé”®å€¼å¯¹ç»„æˆçš„ï¼Œå…·ä½“æœ‰å“ªäº›é”®å€¼å¯¹åˆ™å®Œå…¨å–å†³äºæœåŠ¡å™¨ç¨‹åº
ç›®å‰ï¼Œå¯¹æˆ‘ä»¬æœ€é‡è¦çš„é”®å€¼å¯¹æ˜¯`Content-Type`ï¼Œå®ƒæœ‰å¤šç§å–å€¼ï¼Œè¡¨ç¤ºå“åº”ä½“çš„æ•°æ®ç±»å‹
åœ¨ã€ŒB/Sã€æ¨¡å¼ä¸­ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ ¹æ®å“åº”å¤´ä¸­`Content-Type`çš„å–å€¼ï¼Œå†³å®šå¦‚ä½•å¤„ç†å“åº”ä½“ï¼š

1. `text/plain`ï¼šæ™®é€šçš„çº¯æ–‡æœ¬ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šå°†å“åº”ä½“åŸå°ä¸åŠ¨çš„æ˜¾ç¤ºåˆ°é¡µé¢ä¸Š
2. `text/html`ï¼šhtmlæ–‡æ¡£ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šå°†å“åº”ä½“ä½œä¸ºé¡µé¢è¿›è¡Œæ¸²æŸ“
3. `text/javascript`æˆ–`application/javascript`ï¼šjsä»£ç ï¼Œæµè§ˆå™¨é€šå¸¸ä¼šä½¿ç”¨JSæ‰§è¡Œå¼•æ“å°†å®ƒè§£ææ‰§è¡Œ
4. `text/css`ï¼šcssä»£ç ï¼Œæµè§ˆå™¨ä¼šå°†å®ƒè§†ä¸ºæ ·å¼è¡¨
5. `image/å›¾ç‰‡æ ¼å¼[webp/jpeg/png/...]`ï¼šæµè§ˆå™¨ä¼šå°†å®ƒè§†ä¸ºjpgå›¾ç‰‡
6. `attachment `ï¼šé™„ä»¶ï¼Œæµè§ˆå™¨çœ‹åˆ°è¿™ä¸ªç±»å‹ï¼Œé€šå¸¸ä¼šè§¦å‘ä¸‹è½½åŠŸèƒ½
7. å…¶ä»–`MIME`ç±»å‹

### å“åº”ä½“

è¯·æ±‚è¿”å›çš„æ•°æ®åŠå†…å®¹ï¼Œæ ¼å¼å’Œå“åº”å¤´ä¸­çš„`Content-Type`ç›¸å¯¹åº”



# `Cookie`

`cookie`æ˜¯æµè§ˆå™¨ä¸­ç‰¹æœ‰çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒå°±åƒæµè§ˆå™¨çš„ä¸“å±å¡åŒ…ï¼Œç®¡ç†ç€å„ä¸ªç½‘ç«™çš„èº«ä»½ä¿¡æ¯

**`cookie`çš„ç‰¹ç‚¹**ï¼šä¿å­˜åœ¨æµè§ˆå™¨ç«¯çš„å°å‹æ–‡æœ¬æ•°æ®ï¼Œè¯·æ±‚è‡ªåŠ¨æºå¸¦ï¼ŒæœåŠ¡å™¨å¯æ§
**`cookie`çš„ç¼ºç‚¹**ï¼šåªèƒ½ä»¥å­—ç¬¦ä¸²æ ¼å¼å‚¨å­˜ã€å­˜å‚¨é‡æœ‰é™ï¼ˆå•ä¸ªè¯·æ±‚é™åˆ¶åœ¨`4KB`å·¦å³ï¼‰ã€æ•°æ®å®¹æ˜“è¢«çªƒå–ç¯¡æ”¹å’Œä¸¢å¤±



## ä¸ºä»€ä¹ˆè¦æœ‰`cookie`ï¼Ÿ

æœ¬è´¨æ˜¯ä¸ºæ— çŠ¶æ€çš„`HTTP`åè®® â€œå¢åŠ è®°å¿†èƒ½åŠ›â€ï¼Œè®©æœåŠ¡å™¨èƒ½å¤Ÿè¯†åˆ«å®¢æˆ·ç«¯ã€ä¿ç•™çŠ¶æ€ä¿¡æ¯



## `cookie`ä¿¡æ¯

æ¯ä¸ª`cookie`å°±ç›¸å½“äºæ˜¯å±äºæŸä¸ªç½‘ç«™çš„ä¸€ä¸ªå¡ç‰‡ï¼Œè®°å½•äº†ä»¥ä¸‹ä¿¡æ¯ï¼š

- `key`ï¼šé”®ï¼Œæ¯”å¦‚ã€Œèº«ä»½ç¼–å·ã€

- `value`ï¼šå€¼ï¼Œæ¯”å¦‚èº«ä»½ç¼–å·ã€Œ1456BC95ã€ï¼Œè¿™æœ‰ç‚¹åƒå¡ç‰‡çš„æ¡å½¢ç ï¼Œå½“ç„¶å®ƒå¯ä»¥æ˜¯ä»»ä½•ä¿¡æ¯

- `domain`ï¼šåŸŸï¼Œè¡¨è¾¾è¿™ä¸ª`cookie`æ˜¯å±äºå“ªä¸ªç½‘ç«™çš„ï¼ŒåŒ¹é…è§„åˆ™å¦‚ä¸‹ï¼š

  ```js
  domain = `bilibili.com`
  // å¯ä»¥åŒ¹é…ï¼š'bilibili.com' 'www.bilibili.com' ...
  
  domain = `www.bilibili.com`
  // å°±åªèƒ½åŒ¹é… 'www.bilibili.com'
  ```

- `path`ï¼šè·¯å¾„ï¼Œè¡¨ç¤º`cookie`æ˜¯å±äºè¯¥ç½‘ç«™çš„å“ªä¸ªè·¯å¾„çš„ï¼Œä¸æ»¡è¶³è¯¥è·¯å¾„çš„è¯·æ±‚ä¸ä¼šæºå¸¦è¯¥`cookie`

  ```js
  æ¯”å¦‚`cookie`ä¸­çš„`path`æ˜¯`/news`
  åˆ™å¯ä»¥åŒ¹é…çš„è¯·æ±‚è·¯å¾„å¯ä»¥æ˜¯`/news`ã€`/news/detail`ã€`/news/a/b/c`ç­‰,ä½†ä¸èƒ½åŒ¹é…`/blogs`
  
  å¦‚æœ`path`æ˜¯`/`ï¼Œåˆ™è¯¥åŸŸåä¸‹æ‰€æœ‰è·¯å¾„éƒ½å¯ä»¥åŒ¹é…
  ```

- `secure`ï¼šæ˜¯å¦ä½¿ç”¨å®‰å…¨ä¼ è¾“

  ```js
  `cookie`ä¸­æœ‰`secure`ï¼Œåˆ™è¯·æ±‚åè®®å¿…é¡»æ˜¯`https`ï¼Œå¦åˆ™ä¸ä¼šå‘é€è¯¥`cookie`
  `cookie`ä¸­æ²¡æœ‰è¯¥å±æ€§ï¼Œåˆ™è¯·æ±‚åè®®å¯ä»¥æ˜¯`http`ï¼Œä¹Ÿå¯ä»¥æ˜¯`http`
  ```

- `expire`ï¼šè¿‡æœŸæ—¶é—´ï¼Œè¡¨ç¤ºè¯¥`cookie`åœ¨ä»€ä¹ˆæ—¶å€™è¿‡æœŸ

- `httpOnly`ï¼šç¦æ­¢å®¢æˆ·ç«¯é€šè¿‡`JavaScript document.cookie`è®¿é—®è¯¥ `cookie`ï¼Œé˜²æ­¢`XSS`è·¨ç«™è„šæœ¬æ”»å‡»çªƒå–

- `sameSite`ï¼šé™åˆ¶ç¬¬ä¸‰æ–¹è¯·æ±‚æºå¸¦`cookie`ï¼Œé˜²æ­¢`CSRF`è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œå–å€¼ï¼š

  ```js
  `Strict`: ä»…åŒç«™è¯·æ±‚æºå¸¦
  `Lax`: éƒ¨åˆ†è·¨ç«™è¯·æ±‚å…è®¸ï¼Œé»˜è®¤å€¼
  `None`: å…è®¸æ‰€æœ‰è¯·æ±‚ï¼Œä½†éœ€é…åˆ`Secure`å±æ€§
  ```



## æºå¸¦`cookie`

å½“æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥`cookie`å¡åŒ…ï¼Œçœ‹çœ‹å“ªäº›é€‚åˆé™„å¸¦å‘é€ç»™æœåŠ¡å™¨
é‚£ä¹ˆæ»¡è¶³å“ªäº›æ¡ä»¶ä¸‹ï¼Œæµè§ˆå™¨çš„è¯·æ±‚ä¼šé™„å¸¦è¿™ä¸ª`cookie`å‘¢ï¼Ÿ

1. `cookie`æ²¡æœ‰è¿‡æœŸ
2. `cookie`ä¸­çš„åŸŸå’Œè¿™æ¬¡è¯·æ±‚çš„åŸŸæ˜¯åŒ¹é…çš„ï¼Œ`cookie`ä¸åœ¨ä¹ç«¯å£ï¼Œåªè¦åŸŸåŒ¹é…å³å¯
3. `cookie`ä¸­çš„`path`å’Œè¿™æ¬¡è¯·æ±‚çš„`path`æ˜¯åŒ¹é…çš„
4. éªŒè¯`cookie`çš„å®‰å…¨ä¼ è¾“`secure`

å¦‚æœä¸€ä¸ª`cookie`æ»¡è¶³äº†ä¸Šè¿°çš„æ‰€æœ‰æ¡ä»¶
**æµè§ˆå™¨ä¼šå°†ç¬¦åˆæ¡ä»¶çš„`cookie`çš„é”®å€¼æŒ‰ç…§`key=value`è‡ªåŠ¨æ”¾ç½®åˆ°è¿™æ¬¡è¯·æ±‚çš„è¯·æ±‚å¤´ä¸­**
`cookie`ä¸­åŒ…å«äº†é‡è¦çš„èº«ä»½ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸èƒ½æ³„éœ²ï¼Œå¦åˆ™å¯ä»¥é€šè¿‡`cookie`ä¼ªé€ èº«ä»½ä¿¡æ¯



## è®¾ç½®`cookie`

### æœåŠ¡å™¨å“åº”

è¿™ç§æ¨¡å¼æ˜¯éå¸¸æ™®éçš„ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”çš„æ¶ˆæ¯ä¸­åŒ…å«`cookie`ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨çš„æŠŠ`cookie`ä¿å­˜åˆ°å¡åŒ…ä¸­
å¦‚æœå·²ç»å­˜åœ¨`keyã€pathã€domain`å±æ€§éƒ½ç›¸åŒçš„`cookie`äº†ï¼Œåˆ™è‡ªåŠ¨è¦†ç›–ä¹‹å‰çš„è®¾ç½®

```yaml
# æœåŠ¡å™¨å¯ä»¥é€šè¿‡è®¾ç½®å“åº”å¤´ï¼Œæ¥å‘Šè¯‰æµè§ˆå™¨åº”è¯¥å¦‚ä½•è®¾ç½®`cookie`
Set-Cookie: cookie_1
Set-Cookie: cookie_2
...
```

é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨ä¸€æ¬¡å“åº”ä¸­è®¾ç½®å¤šä¸ª`cookie`ï¼Œæ¯ä¸ª`cookie`æ ¼å¼å¦‚ä¸‹

```js
é”®=å€¼; path=?; domain=?; expire=?; max-age=?; secure; httponly
```

**æ¯ä¸ª`cookie`ä¸­ï¼Œé™¤äº†`é”®=å€¼`æ˜¯å¿…é¡»è¦è®¾ç½®çš„ï¼Œå…¶ä»–çš„å±æ€§éƒ½æ˜¯å¯é€‰çš„ï¼Œä¸”é¡ºåºä¸é™**

- `path`ï¼šå¦‚æœæœåŠ¡å™¨ä¸è®¾ç½®ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰è¯·æ±‚çš„è·¯å¾„

- `domain`ï¼šå¦‚æœæœåŠ¡å™¨ä¸è®¾ç½®ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰è¯·æ±‚çš„åŸŸå

  > å¦‚æœè®¾ç½®äº†æ— æ•ˆçš„åŸŸï¼Œæµè§ˆå™¨æ˜¯ä¸è®¤å¯çš„ï¼Œå³`domain`çš„å€¼ä¸è¯·æ±‚çš„åŸŸåéƒ½ä¸ä¸€æ ·

- `expire`ï¼šè®¾ç½®`cookie`çš„è¿‡æœŸæ—¶é—´ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„`GMT`æ—¶é—´ï¼Œå³æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´å­—ç¬¦ä¸²

  > ä¾‹å¦‚`Wed, 06 Aug 2025 08:53:34 GMT`ï¼Œ**å®¢æˆ·ç«¯è¾¾åˆ°è¿™ä¸ªäº‹ä»¶åè‡ªåŠ¨é”€æ¯è¯¥`cookie`**

- `max-age`ï¼šè®¾ç½®`cookie`çš„æœ‰æ•ˆæ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œé€šå¸¸`expire`å’Œ`max-age`è®¾ç½®ä¸€ä¸ªå°±è¡Œ

  > å¦‚æœæ—¢ä¸è®¾ç½®`expire`ï¼Œä¹Ÿä¸è®¾ç½®`max-age`å±æ€§ï¼Œåˆ™æµè§ˆå™¨çª—å£å…³é—­åå°±å¤±æ•ˆ

- `secure`ï¼šæ˜¯å¦æ˜¯å®‰å…¨è¿æ¥ï¼Œå¦‚æœè®¾ç½®äº†è¯¥å€¼ï¼Œåˆ™è¯·æ±‚å¿…é¡»ä¸º`https`åè®®

- `httponly`ï¼šè®¾ç½®`cookie`æ˜¯å¦ä»…èƒ½ç”¨äºä¼ è¾“ï¼Œä¸èƒ½å®¢æˆ·ç«¯é€šè¿‡JSè·å–

  > å¦‚æœè®¾ç½®äº†è¯¥å€¼ï¼Œè¡¨ç¤ºè¯¥`cookie`ä»…èƒ½ç”¨äºä¼ è¾“ï¼Œè€Œä¸å…è®¸åœ¨å®¢æˆ·ç«¯é€šè¿‡JSè·å–
  > ä¾‹å¦‚åœ¨`iframe`ä¸­è·å–çˆ¶çº§åŸŸåçš„`cookie`ï¼Œé˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»`XSS`

äºæ˜¯ï¼Œåªè¦æ»¡è¶³è¦æ±‚ï¼Œè¿™ä¸ª`cookie`å°±ä¼šè‡ªåŠ¨é™„åŠ åˆ°è¯·æ±‚å¤´çš„`cookie`ä¸­

```yaml
Cookie: token=12345; key=value; å…¶ä»–cookie ...
```

æœåŠ¡å™¨å¦‚ä½•åˆ é™¤æµè§ˆå™¨çš„ä¸€ä¸ª`cookie`ï¼Ÿ
**åªéœ€è¦è®©æœåŠ¡å™¨å“åº”ä¸€ä¸ª`keyã€domainã€path`ç›¸åŒï¼Œä½†æ˜¯æ—¶é—´è¿‡æœŸçš„`cookie`å³å¯**
**æ‰€ä»¥ï¼Œåˆ é™¤`cookie`å…¶å®å°±æ˜¯ä¿®æ”¹`cookie`**

```yaml
# åŸæ¥çš„cookie
token=12345; domain=yuanjin.tech; path=/; max-age=3600
# è®¾ç½®æ—¶é—´è¿‡æœŸï¼Œæµè§ˆå™¨è‡ªåŠ¨é”€æ¯
Set-Cookie: token=; domain=yuanjin.tech; path=/; max-age=-1
```



### å®¢æˆ·ç«¯è®¾ç½®

å› ä¸º`cookie`æ˜¯å­˜æ”¾åœ¨æµè§ˆå™¨ç«¯çš„ï¼Œæ‰€ä»¥æµè§ˆå™¨å‘JSå…¬å¼€äº†æ¥å£è®©å…¶å¯ä»¥è®¾ç½®

```js
document.cookie = 'é”®=å€¼; path=?; domain=?; expire=?; max-age=?; secure'
```

å®¢æˆ·ç«¯è®¾ç½®`cookie`æœ‰å‡ ç‚¹ä¸åŒï¼š

- æ²¡æœ‰`httponly`ï¼Œå› ä¸º`httponly`å°±æ˜¯ä¸ºäº†é™åˆ¶åœ¨å®¢æˆ·ç«¯è®¿é—®çš„ï¼Œæ‰€ä»¥åœ¨å®¢æˆ·ç«¯é…ç½®å¤±å»äº†é™åˆ¶çš„æ„ä¹‰
- `path`åœ¨å®¢æˆ·ç«¯è®¾ç½®æ—¶çš„é»˜è®¤å€¼æ˜¯å½“å‰ç½‘é¡µçš„`path`
- `domain`çš„é»˜è®¤å€¼æ˜¯å½“å‰ç½‘é¡µçš„`domain`åŸŸå

å®¢æˆ·ç«¯åˆ é™¤`cookie`å’ŒæœåŠ¡å™¨ä¹Ÿä¸€æ ·ï¼Œä¿®æ”¹`cookie`çš„è¿‡æœŸæ—¶é—´å³å¯



# `Session`

ä¸`Cookie`ç±»ä¼¼ï¼ŒåŒæ ·å¯ä»¥è§£å†³`HTTP`è¯·æ±‚æ— çŠ¶æ€çš„é—®é¢˜

**`Session`çš„ä¼˜ç‚¹ï¼š**

- æ•°æ®å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œé€šè¿‡`Session ID`æŸ¥æ‰¾æ•°æ®ï¼Œå®‰å…¨æ€§å’Œå¯æ§æ€§é«˜ï¼Œæ•°æ®éš¾ä»¥è¢«è·å–å’Œç¯¡æ”¹
- æ•°æ®å­˜å‚¨æ²¡æœ‰å¤§å°é™åˆ¶ï¼Œå¹¶ä¸”ç±»å‹å¯ä»¥æ˜¯ä»»ä½•æ ¼å¼
- å‡å°‘æ•æ„Ÿæ•°æ®ä¼ è¾“ï¼Œä»…ä¼ è¾“`Session ID`æ¥æ ‡è¯†ç”¨æˆ·æˆ–çŠ¶æ€

**`Session`çš„ç¼ºç‚¹ï¼š**

- å ç”¨æœåŠ¡å™¨èµ„æºï¼Œå¢åŠ å­˜å‚¨æˆæœ¬
- ä¸€èˆ¬åœºæ™¯ä¸‹ï¼Œè¿˜æ˜¯éœ€è¦ä¾èµ–`Cookie`æ¥ä¼ è¾“å”¯ä¸€æ€§çš„`Session ID`
- åˆ†å¸ƒå¼é›†ç¾¤æœåŠ¡å™¨ä¸­éš¾ä»¥ä¿è¯`Session ID`ä¸€è‡´æ€§

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé€šå¸¸éœ€ç»“åˆ`Redis`ç­‰å·¥å…·å®ç°`Session`å…±äº«ï¼Œä»¥åº”å¯¹é«˜å¹¶å‘åœºæ™¯å’Œä¿æŒä¸€è‡´æ€§

**`Session`æ ¸å¿ƒæ˜¯ï¼šæœåŠ¡å™¨ç«¯å­˜å‚¨çŠ¶æ€æ•°æ® + å®¢æˆ·ç«¯ä¼ é€’å”¯ä¸€æ ‡è¯†**
é€šè¿‡ã€åˆ›å»ºâ†’å…³è”â†’ç»´æŠ¤â†’é”€æ¯ã€‘æµç¨‹è§£å†³`HTTP`æ— çŠ¶æ€é—®é¢˜

![image-20250808101525338](./assets/image-20250808101525338.png)



# `JWT`

å…¨ç§°`Json Web Token`ï¼Œæ˜¯ä¸€ç§ç”¨äºåœ¨ç½‘ç»œåº”ç”¨é—´å®‰å…¨ä¼ é€’ä¿¡æ¯çš„è½»é‡çº§ã€ç´§å‡‘çš„ä»¤ç‰Œæ ¼å¼

**ç›®çš„å°±æ˜¯ä¸ºå¤šç§ç»ˆç«¯è®¾å¤‡ï¼Œæä¾›ç»Ÿä¸€çš„ã€å®‰å…¨çš„ä»¤ç‰Œæ ¼å¼**

![image-20250808120349002](./assets/image-20250808120349002.png)



## å‚¨å­˜&ä¼ è¾“

å› ä¸º`JWT`åªæ˜¯ä¸€ç§ä»¤ç‰Œæ ¼å¼ï¼Œæ‰€ä»¥æ²¡æœ‰å­˜å‚¨é™åˆ¶ï¼Œå¯ä»¥æ˜¯`Cookie`ã€`localStorage`ã€`æ–‡ä»¶`ç­‰ç­‰
å¯¹äºä¼ è¾“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹å¼ï¼š`Set-Cookie`ã€`	æ¶ˆæ¯å¤´å­—æ®µ`ã€`body`ç­‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è‡ªè¡Œçº¦å®šå³å¯

ä¸€èˆ¬æ˜¯æœåŠ¡ç«¯å“åº”åœ¨å“åº”å¤´ä¸­ï¼š`Authorization: jwtä»¤ç‰Œ`å‘é€ç»™å®¢æˆ·ç«¯
å®¢æˆ·ç«¯ä¼šåœ¨è¯·æ±‚å¤´ä¸­è®¾ç½®`Authorization: Bearer jwtä»¤ç‰Œ`ä¼ é€’ç»™æœåŠ¡å™¨
**è¿™æ˜¯`OAuth2`é™„å¸¦tokençš„ä¸€ç§è§„èŒƒæ ¼å¼**



## ç»„æˆéƒ¨åˆ†

ä¸ºäº†ä¿è¯ä»¤ç‰Œçš„å®‰å…¨æ€§ï¼Œ`JWT`ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç”¨`.`åˆ†éš”ï¼Œåˆ†åˆ«æ˜¯ï¼š`header.payload.signature`

### `header`

ä»¤ç‰Œå¤´éƒ¨ï¼Œè®°å½•äº†æ•´ä¸ªä»¤ç‰Œçš„ç±»å‹å’Œç­¾åç®—æ³•

```js
{
  "alg": "HS256", // åŠ å¯†ç®—æ³•
  "typ": "JWT" // ä»¤ç‰Œç±»å‹ï¼Œå›ºå®šä¸º`jwt`
}
```

å¤´éƒ¨ä¼šè¢«`Base64URL`ç¼–ç ï¼Œä½œä¸º`JWT`çš„ç¬¬ä¸€éƒ¨åˆ†

### `payload`

ä»¤ç‰Œè½½è·ï¼Œè®°å½•äº†è¦ä¼ é€’çš„å£°æ˜ï¼Œä¾‹å¦‚è¦ä¿å­˜çš„éæ•æ„Ÿç”¨æˆ·ä¿¡æ¯å°±å¯ä»¥æ”¾åˆ°è¿™é‡Œ

```js
payload_pre_encode = {
  /**
  * æ ‡å‡†å£°æ˜ï¼Œ `JWT`è§„èŒƒä¸­å®šä¹‰çš„å¯é€‰å£°æ˜ï¼Œç”¨äºæä¾›å¸¸è§çš„ã€è·¨ç³»ç»Ÿçš„ä¿¡æ¯
  * éå¼ºåˆ¶ï¼Œå»ºè®®æ ¹æ®éœ€æ±‚ä½¿ç”¨
  */
  `iss`ï¼š'ç­¾å‘è€…ï¼Œæ ‡è¯†ç”Ÿæˆ JWT çš„å®ä½“',
  `sub`: 'ä¸»é¢˜ï¼Œé€šå¸¸æ˜¯ä»¤ç‰Œæ‰€é¢å‘çš„ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ç”¨æˆ· IDï¼‰',
  `aud`: 'å—ä¼—ï¼ŒæŒ‡å®šä»¤ç‰Œçš„æ¥æ”¶æ–¹ï¼ˆå¦‚ç‰¹å®šçš„ API æœåŠ¡ï¼‰ï¼Œï¼ˆéªŒè¯æ—¶ä¼šæ£€æŸ¥æ¥æ”¶æ–¹æ˜¯å¦åœ¨å—ä¼—åˆ—è¡¨ä¸­ï¼‰',
  `exp`: 'è¿‡æœŸæ—¶é—´ï¼Œä»¥æ—¶é—´æˆ³è¡¨ç¤ºï¼Œä»¤ç‰Œåœ¨æ­¤æ—¶é—´åå¤±æ•ˆï¼ˆå¿…é¡»è®¾ç½®ï¼Œä¸”æ˜¯æ ¸å¿ƒå®‰å…¨æœºåˆ¶ï¼‰',
  `nbf`: 'Not Beforeï¼Œç”Ÿæ•ˆæ—¶é—´ï¼Œä»¥æ—¶é—´æˆ³è¡¨ç¤ºï¼Œä»¤ç‰Œåœ¨æ­¤æ—¶é—´å‰æ— æ•ˆ',
  `iat`: 'ç­¾å‘æ—¶é—´ï¼Œä»¥æ—¶é—´æˆ³è¡¨ç¤ºä»¤ç‰Œçš„ç”Ÿæˆæ—¶é—´',
  `jti`: 'JWT IDï¼Œ ä»¤ç‰Œå”¯ä¸€æ ‡è¯†ï¼Œç”¨äºé˜²æ­¢é‡æ”¾æ”»å‡»',
  // é‡æ”¾æ”»å‡»ï¼šæŒ‡åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œç”¨æˆ·ä½¿ç”¨ä¹‹å‰çš„ä»¤ç‰Œå‘é€åˆ°æœåŠ¡å™¨ï¼Œè¢«æœåŠ¡å™¨æ­£ç¡®çš„è¯†åˆ«
  
  /**
  * å…¬å…±å£°æ˜ï¼Œç”±å¼€å‘è€…è‡ªå®šä¹‰
  * ä½†éœ€è¦é¿å…ä¸æ ‡å‡†å£°æ˜å†²çªï¼Œé€šå¸¸ç”¨äºä¼ é€’ä¸šåŠ¡ç›¸å…³çš„éæ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ğŸ‘‡
  */
  role: 'admin',
  department: 'IT',
  
  /**
  * ç§æœ‰å£°æ˜ï¼Œç”±é€šä¿¡åŒæ–¹çº¦å®šçš„è‡ªå®šä¹‰å£°æ˜ï¼Œä»…åœ¨ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ï¼Œä¸å¯¹å¤–å…¬å¼€
  */
  tenantId: '2736763'
}
```

è½½è·ä¹Ÿä¼šè¢«`Base64URL`ç¼–ç ï¼Œä½œä¸º`JWT`çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œ**`Base64URL`ç¼–ç æ˜¯å¯é€†çš„ï¼Œä¸è¦åœ¨è½½è·ä¸­æ”¾æ•æ„Ÿä¿¡æ¯**

### `signature`

ä»¤ç‰Œç­¾åï¼Œå®ƒä¿è¯æ•´ä¸ª`JWT`ä¸è¢«ç¯¡æ”¹çš„å…³é”®

**ç”Ÿæˆæ–¹å¼ï¼šç”¨`header`ä¸­æŒ‡å®šçš„ç®—æ³•ï¼Œå°†`Base64URL`ç¼–ç åçš„`Headerã€Payload`åŠ ä¸Š`å¯†é’¥`ç»„åˆè®¡ç®—è€Œæˆ**

```js
// ä»¥`HS256`åŠ å¯†ç®—æ³•ä¸ºä¾‹
signature = HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)
```

ç”Ÿæˆçš„`signature`ç­¾åï¼Œä¾æ—§ä¼šè¢«`Base64URL`ç¼–ç ï¼Œä½œä¸º`JWT`çš„ç¬¬ä¸‰éƒ¨åˆ†

> [!NOTE]
>
> `Base64 URL`ä¸æ˜¯ä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼Œè€Œæ˜¯ä¸€ç§ç¼–ç æ–¹å¼
> æ˜¯åœ¨`base64`ç®—æ³•çš„åŸºç¡€ä¸Šå¯¹æ‰‹`ã€`ã€`=`ã€`/`ä¸‰ä¸ªå­—ç¬¦åšå‡ºç‰¹æ®Šå¤„ç†çš„ç®—æ³•
>
> è€Œ`base64`æ˜¯ä½¿ç”¨`64`ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®



## éªŒè¯æµç¨‹

1. å®¢æˆ·ç«¯è¯·æ±‚ç™»å½•ï¼Œè·å–`JWT`
2. æœåŠ¡å™¨éªŒè¯ç”¨æˆ·èº«ä»½ï¼ˆç”¨æˆ·åå¯†ç ï¼‰ï¼Œå¹¶ç”Ÿæˆ`JWT`ç›¸åº”ç»™å®¢æˆ·ç«¯
3. å®¢æˆ·ç«¯æ”¶åˆ°`JWT`åæ ¹æ®éœ€æ±‚å’Œåœºæ™¯è‡ªå®šä¹‰å­˜å‚¨æ–¹æ¡ˆ`Cookie | localStorage | file | state`
4. ä¸‹æ¬¡è¯·æ±‚å®¢æˆ·ç«¯æºå¸¦`JWT`å‘é€ç»™æœåŠ¡å™¨
5. æœåŠ¡å™¨éªŒè¯`JWT`çš„æœ‰æ•ˆæ€§
   - åˆ†åˆ«æå–`header/payload/signatuer`ï¼Œå†ç”¨æœåŠ¡å™¨ä¿å­˜çš„`å¯†é’¥`å†æ¬¡è®¡ç®—å‡º`signature`ï¼Œä¸ä¹‹ç›¸æ¯”è¾ƒ
   - éªŒè¯`payload`ä¸­çš„`exp`è¿‡æœŸæ—¶é—´å’Œ`aud`å—ä¼—æ˜¯å¦æ»¡è¶³è¦æ±‚
   - ......
6. æ ¹æ®éªŒè¯ç»“æœæ˜¯å¦é€šè¿‡ï¼Œå“åº”è¯·æ±‚

> [!NOTE]
>
> è¿™äº›éªŒè¯éƒ½éœ€è¦æœåŠ¡å™¨æ‰‹åŠ¨å®Œæˆï¼Œæ²¡æœ‰å“ªä¸ªæœåŠ¡å™¨ä¼šç»™ä½ è¿›è¡Œè‡ªåŠ¨éªŒè¯



# è¯·æ±‚è·¨åŸŸ

æŒ‡æµè§ˆå™¨ä»ä¸€ä¸ªåŸŸåçš„ç½‘é¡µå»è¯·æ±‚å¦ä¸€ä¸ªåŸŸåçš„èµ„æºæ—¶ï¼Œç”±äºæµè§ˆå™¨çš„å®‰å…¨é™åˆ¶ï¼ˆåŒæºç­–ç•¥ï¼‰è€Œäº§ç”Ÿçš„é™åˆ¶æˆ–é”™è¯¯
**å› æ­¤ï¼Œè·¨åŸŸåªåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å‘ç”Ÿ**



## åŒæºç­–ç•¥`Same-Origin Policy`

æŒ‡çš„æ˜¯ä¸¤ä¸ªURLåœ°å€çš„**åè®®ã€åŸŸåã€ç«¯å£**ä¸‰è€…å®Œå…¨ä¸€è‡´ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸åŒï¼Œå°±æ˜¯ä¸åŒæºï¼Œåˆ™ä¼šäº§ç”Ÿè·¨åŸŸ

è·¨åŸŸé™åˆ¶çš„æ ¸å¿ƒå°±æ˜¯æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œè¿™æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç›®çš„æ˜¯**é˜²æ­¢æ¶æ„ç½‘ç«™çªƒå–å¦ä¸€ä¸ªç½‘ç«™çš„æ•æ„Ÿæ•°æ®**
æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¸å…è®¸ä½¿ç”¨ä¸åŒæºçš„æ•°æ®



## `JSONP`

åˆ©ç”¨`<script>`æ ‡ç­¾ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹æ€§ï¼Œè¾¾åˆ°è·¨åŸŸè·å–æ•°æ®ï¼Œç¼ºé™·æ˜¯ä»…æ”¯æŒ`GET`è¯·æ±‚

```js
function jsonp(url, callback) {
  const script = document.createElement('script')
  script.src = url
  document.body.appendChild(script)
  
  script.onload = () => {
    script.remove()
  }
  // å…¨å±€å®šä¹‰æœåŠ¡å™¨è¿”å›çš„å›è°ƒå‡½æ•°
  // æœåŠ¡å™¨è¿”å›çš„æ˜¯ä¸€æ®µJSä»£ç ï¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°æ˜¯æœåŠ¡å™¨è¿”å›çš„æ•°æ®
  window[callback] = function (data) {
    console.log(data)
    delete window[callback]
  }
}

const callbackName = 'handleResponse'
jsonp(`http://localhost:5000/api/jsonp?callback=${callbackName}`)
```

```js
// æœåŠ¡å™¨ç«¯ä»£ç  (Express)
app.get('/api/jsonp', (req, res) => {
  // è·å–å›è°ƒå‡½æ•°å
  const callback = req.query.callback
  // è¦è¿”å›çš„æ•°æ®
  const data = { message: 'è¿™æ˜¯JSONPè¿”å›çš„æ•°æ®' }
  // æ„é€ JSONPå“åº”
  const response = `${callback}(${JSON.stringify(data)})`
  // è®¾ç½®Content-Type
  res.setHeader('Content-Type', 'application/javascript')
  // è¿”å›æ•°æ®
  res.send(response)
})
```



## è·¨åŸŸèµ„æºå…±äº«`CORS`

è·¨åŸŸèµ„æºå…±äº«`Cross-Origin Resource Sharing`ï¼Œæ˜¯åŸºäº`HTTP1.1`çš„ä¸€ç§è·¨åŸŸè§£å†³æ–¹æ¡ˆ
æ ¸å¿ƒæ€è·¯æ˜¯**å¦‚æœæµè§ˆå™¨è¦è·¨åŸŸè®¿é—®æœåŠ¡å™¨çš„èµ„æºï¼Œéœ€è¦è·å¾—æœåŠ¡å™¨çš„å…è®¸**
**æœåŠ¡å™¨åœ¨å“åº”å¤´ä¸­æ·»åŠ ç‰¹å®šå­—æ®µï¼Œå£°æ˜å…è®¸å“ªäº›æºã€æ–¹æ³•ã€å¤´ä¿¡æ¯çš„è·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨éªŒè¯é€šè¿‡åå…è®¸å‰ç«¯è®¿é—®å“åº”**

å½“æµè§ˆå™¨ç«¯è¿è¡Œäº†ä¸€æ®µ`Ajax`ä»£ç ï¼Œæ— è®ºæ˜¯ä½¿ç”¨`XHR`è¿˜æ˜¯`Fetch`ï¼Œæµè§ˆå™¨ä¼šé¦–å…ˆåˆ¤æ–­å®ƒå±äºå“ªä¸€ç§è¯·æ±‚æ¨¡å¼
é’ˆå¯¹ä¸åŒçš„è¯·æ±‚ï¼Œ`CORS`è§„å®šäº†ä¸‰ç§ä¸åŒçš„äº¤äº’æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š

- ç®€å•è¯·æ±‚
- éœ€è¦é¢„æ£€çš„è¯·æ±‚
- é™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚

è¿™ä¸‰ç§æ¨¡å¼ä»ä¸Šåˆ°ä¸‹å±‚å±‚é€’è¿›ï¼Œè¯·æ±‚å¯ä»¥åšçš„äº‹è¶Šæ¥è¶Šå¤šï¼Œè¦æ±‚ä¹Ÿè¶Šæ¥è¶Šä¸¥æ ¼



### ç®€å•è¯·æ±‚

å½“è¯·æ±‚åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œæµè§ˆå™¨ä¼šè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªç®€å•è¯·æ±‚ï¼š

- è¯·æ±‚æ–¹æ³•ä¸º`GET | POST | HEAD`ä¸­çš„ä¸€ç§

- è¯·æ±‚å¤´ä»…åŒ…å«å®‰å…¨çš„å­—æ®µï¼Œå¸¸è§å®‰å…¨å­—æ®µå¦‚ä¸‹ğŸ‘‡

  `Accept`ã€`Accept-Language`ã€`Content-Language`ã€`Content-Type`ã€`DPR`ã€`DownLink`ã€

  `Save-Data`ã€`Vieweport-Width`ã€`Width`

- å¦‚æœåŒ…å«`Content-Type`å­—æ®µï¼Œå…¶å€¼ä»…é™ä»¥ä¸‹3ç§ï¼š

  `text/plain`ã€`multipart/form-data`ã€`application/x-www-form-urlencoded`

```js
// ç®€å•è¯·æ±‚
fetch('http://cors_test.com/api')
// è¯·æ±‚æ–¹æ³•ä¸æ»¡è¶³ï¼Œä¸æ˜¯ç®€å•è¯·æ±‚
fetch('http://cors_test.com/api', { method: 'PUT' })
// æœ‰é¢å¤–éå®‰å…¨å­—æ®µçš„è¯·æ±‚å¤´å­—æ®µï¼Œä¸æ˜¯
fecth('http://cors_test.com/api', { headers: { a: 1 } })
// è¯·æ±‚å¤´ä¸­`content-type`å­—æ®µçš„å€¼ä¸æ»¡è¶³ï¼Œä¸æ˜¯
fetch('http://cors_test.com/api', {
  method: 'POST', headers: { 'content-type': 'application/json' }
})
```

å½“æµè§ˆå™¨åˆ¤å®šæŸä¸ª`Ajax`è·¨åŸŸè¯·æ±‚ä¸ºç®€å•è¯·æ±‚æ—¶ğŸ‘‡

- è¯·æ±‚å¤´ä¸­è‡ªåŠ¨æ·»åŠ `Origin`å­—æ®µï¼Œå€¼ä¸ºè¯·æ±‚æºåœ°å€ï¼Œå‘Šè¯‰æœåŠ¡å™¨æ˜¯å“ªä¸ªåœ°å€åœ¨è·¨åŸŸè¯·æ±‚
- æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå¦‚æœå…è®¸è¯¥è¯·æ±‚è·¨åŸŸï¼Œå“åº”å¤´ä¸­åº”è¯¥åŒ…å«`Accecc-Control-Allow-Origin`å­—æ®µ
  - `*`ï¼šè¡¨ç¤ºå…è®¸ä»»ä½•è¯·æ±‚è·¨åŸŸ
  - `å…·ä½“çš„æºåœ°å€`ï¼šä¾‹å¦‚`http://my.com`ï¼Œåˆ™è¡¨ç¤ºåªå…è®¸è¯¥åœ°å€çš„è¯·æ±‚è·¨åŸŸ

ä¸ºäº†é¿å…åç»­çš„éº»çƒ¦ï¼Œå¼ºçƒˆæ¨èå“åº”å…·ä½“çš„æºï¼Œè€Œä¸æ˜¯`*`



### é¢„æ£€è¯·æ±‚

å¦‚æœæµè§ˆå™¨ä¸è®¤ä¸ºè¿™æ˜¯ä¸€ç§ç®€å•è¯·æ±‚ï¼Œå°±ä¼šæŒ‰ç…§ä¸‹é¢é¢çš„æµç¨‹è¿›è¡ŒğŸ‘‡

```js
// è¿™ä¸ªè¯·æ±‚å°±ä¸æ˜¯ä¸€ä¸ªç®€å•è¯·æ±‚
fetch('http://cors_test.com/api', {
  method: 'POST',
  headers: { a: 1, b: 2, 'content-type': 'application/json' },
  body: JSON.stringify({ name: 'Kyle' })
})
```

1. æµè§ˆå™¨å‘é€é¢„æ£€è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦å…è®¸ï¼Œæœ‰ä»¥ä¸‹ç‰¹å¾

   - è¯·æ±‚æ–¹æ³•ä¸º`OPTIONS`ï¼Œæ²¡æœ‰è¯·æ±‚ä½“ã€å“åº”å¤´
   - è¯·æ±‚å¤´ä¸­åŒ…å«ï¼š
     - `Origin`ï¼šè·¨åŸŸè¯·æ±‚çš„æºåœ°å€
     - `Access-Control-Request-Method`ï¼šåç»­çœŸå®è¯·æ±‚å°†ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•
     - `Access-Control-Request-Headers`ï¼šåç»­çœŸå®è¯·æ±‚ä¼šæ”¹åŠ¨çš„è¯·æ±‚å¤´
   
   ```http
   OPTIONS /api HTTP1.1
   Origin: http://cors_test.com
   Access-Control-Request-Method: POST
   Access-Control-Request-Headers: a, b, content-type
   ```
   
2. æœåŠ¡å™¨æ”¶åˆ°é¢„æ£€è¯·æ±‚åï¼Œå¦‚æœå…è®¸ï¼Œéœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ 

   ```js
   // å…è®¸è·¨åŸŸçš„æº
   res.header('access-control-allow-origin', req.headers.origin)
   // å…è®¸åç»­çœŸå®è¯·æ±‚çš„è¯·æ±‚æ–¹æ³•
   res.header('access-control-allow-methods', 'GET, POST, PUT, DELETE')
   // å…è®¸æ”¹åŠ¨çš„è¯·æ±‚å¤´
   res.header('access-control-allow-headers', 'Content-Type, a, b')
   // å‘Šè¯‰æµè§ˆå™¨åœ¨å¤šå°‘ç§’å†…ï¼Œå¯¹äºåŒæ ·çš„è¯·æ±‚æºã€æ–¹æ³•ã€è¯·æ±‚å¤´ï¼Œéƒ½ä¸éœ€è¦å†æ¬¡å‘é€é¢„æ£€è¯·æ±‚
   res.header('access-control-max-age', 1000 * 60 * 60 * 24 * 7)
   ```

3. é¢„æ£€è¯·æ±‚è¢«å…è®¸åï¼Œæµè§ˆå™¨ä¼šå‘é€çœŸå®è¯·æ±‚

4. æœåŠ¡å™¨å®ŒæˆçœŸå®çš„å“åº”ï¼Œå“åº”å¤´ä¸­è¦åŒ…å«`Access-Control-Allow-Origin`å­—æ®µ

![image-20250807194247859](./assets/image-20250807194247859.png)



### å‡­è¯è¯·æ±‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Ajax`çš„è·¨åŸŸè¯·æ±‚å¹¶ä¸ä¼šè‡ªåŠ¨é™„å¸¦`cookie`ï¼Œè¿™æ ·æŸäº›éœ€è¦æƒé™çš„æ“ä½œå°±æ— æ³•è¿›è¡Œ

```js
// xhr
const xhr = new XMLHttpRequest()
xhr.withCredentials = true

// fetch
fetch(url, {
  credentials: 'include'
})

// ä¸¤ç§apiçš„ç®€å•é…ç½®ï¼Œå³å¯å®ç°è·¨åŸŸè¯·æ±‚é™„å¸¦cookie
```

æœåŠ¡å™¨å“åº”æ—¶ï¼Œä¹Ÿéœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ 

```js
Access-Gontrol-Allow-Credentials: true
```

å¯¹äºä¸€ä¸ªé™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼Œè‹¥æœåŠ¡å™¨æ²¡è®¾ç½®å…è®¸æºå¸¦å‡­è¯ï¼Œæµè§ˆå™¨ä»ç„¶è§†ä¸ºè·¨åŸŸè€Œè¢«æ‹’ç»
å¦å¤–è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼šå¯¹äºé™„å¸¦èº«ä»½å‡­è¯çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸å¾—è®¾ç½®`Access-Control-Allow-Origin: *`



### å°è£…å…è®¸è·¨åŸŸä¸­é—´ä»¶

```js
const allowOrigin = [ 'http://127.0.0.1:5500' ]
module.exports = (req, res, next) => {
  const origin = req.headers.origin

  // å¤„ç†é¢„æ£€è¯·æ±‚
  if (req.method === 'OPTIONS') {
    res.header('access-control-allow-methods', req.headers['access-control-request-method'])
    res.header('access-control-allow-headers', req.headers['access-control-request-headers'])
    res.header('access-control-max-age', 1000 * 60 * 60 * 24 * 7)
  }

  // å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦å‡­è¯
  res.header('access-control-allow-credentials', true) 

  // å¤„ç†ç®€å•è¯·æ±‚
  if (origin && allowOrigin.includes(origin)) {
    res.header('access-control-allow-origin', origin)
  }
  next()
}

// NodeJSä¸­å†…ç½®çš„`cors`æ¨¡å—ä¹Ÿå¯ä»¥å®ç°è·¨åŸŸè§£å†³é—®é¢˜
```



## ä»£ç†æœåŠ¡å™¨

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»£ç†æœåŠ¡å™¨è½¬å‘è¯·æ±‚ï¼Œé¿å¼€æµè§ˆå™¨çš„è·¨åŸŸé™åˆ¶
ä¾‹å¦‚`vue-cli`ã€`react-cli`ã€`vite`éƒ½å¯ä»¥é…ç½®ä»£ç†ï¼Œå°½åœ¨å¼€å‘ç¯å¢ƒä¸­å¯ç”¨



## `iframe`

é€‚ç”¨äºä¸¤ä¸ªä¸åŒåŸŸçš„é¡µé¢ä¹‹é—´è¿›è¡Œé€šä¿¡

```html
<!-- å­é¡µé¢ (http://localhost:4000) -->
<script>
  // ç›‘å¬çˆ¶é¡µé¢å‘é€çš„æ¶ˆæ¯
  window.addEventListener('message', (event) => {
    // éªŒè¯æ¶ˆæ¯æ¥æº
    if (event.origin === 'http://localhost:3000') {
      console.log('æ¥è‡ªçˆ¶é¡µé¢çš„æ¶ˆæ¯:', event.data)
      // å‘çˆ¶é¡µé¢å‘é€å›å¤
      event.source.postMessage(
        { type: 'response', message: 'ä½ å¥½ï¼Œçˆ¶é¡µé¢ï¼' },
        event.origin
      )
    }
  })
</script>
```

```html
<!-- çˆ¶é¡µé¢ (http://localhost:3000) -->
<iframe id="iframe" src="http://localhost:4000/child.html"></iframe>

<script>
  // è·å–iframeå…ƒç´ 
  const iframe = document.getElementById('iframe')
  // ç›‘å¬iframeåŠ è½½å®Œæˆ
  iframe.onload = () => {
    // å‘å­é¡µé¢å‘é€æ¶ˆæ¯
    iframe.contentWindow.postMessage(
      { type: 'greeting', message: 'ä½ å¥½ï¼Œå­é¡µé¢ï¼' },
      'http://localhost:4000' // æŒ‡å®šç›®æ ‡åŸŸ
    )
  }
  // ç›‘å¬å­é¡µé¢å‘é€çš„æ¶ˆæ¯
  window.addEventListener('message', (event) => {
    // éªŒè¯æ¶ˆæ¯æ¥æº
    if (event.origin === 'http://localhost:4000') {
      console.log('æ¥è‡ªå­é¡µé¢çš„æ¶ˆæ¯:', event.data)
    }
  })
</script>
```



# æµè§ˆå™¨é¡µé¢å¤„ç†æµç¨‹

å½“åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ä¸€ä¸ªurlåœ°å€ï¼Œå¹¶æŒ‰ä¸‹å›è½¦åï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

![image-20250617202544275](./assets/image-20250617202544275.png)

![image-20250617203509707](./assets/image-20250617203509707.png)



# Ajax

æµè§ˆå™¨æœ¬èº«å°±å…·å¤‡ç½‘ç»œé€šä¿¡çš„èƒ½åŠ›ï¼Œä½†åœ¨æ—©æœŸï¼Œæµè§ˆå™¨å¹¶æ²¡æœ‰æŠŠè¿™ä¸ªèƒ½åŠ›å¼€æ”¾ç»™js
æœ€æ—©æ˜¯å¾®è½¯åœ¨IEæµè§ˆå™¨ä¸­æŠŠè¿™ä¸€èƒ½åŠ›å‘jså¼€æ”¾ï¼Œè®©jså¯ä»¥åœ¨ä»£ç ä¸­å®ç°å‘é€è¯·æ±‚
è¿™é¡¹æŠ€æœ¯åœ¨2005å¹´è¢«æ­£å¼å‘½åä¸º`AJAX (Asynchronous Javascript And XML)`

IEä½¿ç”¨äº†ä¸€å¥—APIæ¥å®Œæˆè¯·æ±‚çš„å‘é€ï¼Œè¦ä¾é ä¸€ä¸ªæ„é€ å‡½æ•°å®Œæˆï¼Œè¯¥æ„é€ å‡½æ•°çš„åç§°ä¸º`XMLHttpRequest`ï¼Œç®€ç§°ä¸º`XHR`
ä½†ç”±äº`XHR API`æœ‰ç€è¯¸å¤šç¼ºé™·ï¼Œåœ¨`HTML5`å’Œ`ES6`å‘å¸ƒä¹‹åï¼Œäº§ç”Ÿäº†ä¸€å¥—æ›´å®Œå–„çš„APIæ¥å‘é€è¯·æ±‚
è¿™å¥—APIä¸»è¦ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå«åš`fetch`çš„å‡½æ•°ï¼Œå› æ­¤åˆç§°`Fetch API`

> [!NOTE]
>
> æ— è®ºæ˜¯`XHR`è¿˜æ˜¯`Fetch`ï¼Œå®ƒä»¬éƒ½æ˜¯å®ç°Ajaxçš„æŠ€æœ¯æ‰‹æ®µï¼Œä¸¤è€…åªæ˜¯ä¸åŒçš„`API`



## `XHR`

```js
// åˆ›å»ºå‘é€è¯·æ±‚çš„å¯¹è±¡
const xhr = new XMLHttpRequest()
xhr.onreadystatechange = function () {
  // å½“è¯·æ±‚çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶è¿è¡Œçš„å‡½æ•°
  // xhr.readyStateï¼šä¸€ä¸ªæ•°å­—ï¼Œç”¨äºåˆ¤æ–­è¯·æ±‚åˆ°äº†å“ªä¸ªé˜¶ä¸ªæ®µ
  // 1ï¼šopenæ–¹æ³•å·²è¢«è°ƒç”¨
  // 2ï¼šsendæ–¹æ³•å·²è¢«è°ƒç”¨
  // 3ï¼šæ­£åœ¨æ¥æ”¶æœåŠ¡å™¨çš„å“åº”æ¶ˆæ¯ä½“
  // 4ï¼šæœåŠ¡å™¨å“åº”çš„æ‰€æœ‰å†…å®¹å‡å·²æ¥æ”¶å®Œæ¯•
  // xhr.responseTextï¼šè·å–æœåŠ¡å™¨å“åº”çš„æ¶ˆæ¯ä½“æ–‡æœ¬
  // xhr.getResponseHeader("Content-Type") è·å–å“åº”å¤´Content - Type

  xhr.open('GET', 'http://localhost:7001/api/herolisst') // é…ç½®è¯·æ±‚
  // xhr.setRequestHeader('Content-Type', 'application/json') è®¾ç½®è¯·æ±‚å¤´
  xhr.send(null) // æ„å»ºè¯·æ±‚ä½“ï¼Œå‘é€åˆ°æœåŠ¡å™¨ï¼Œå¦‚æœæ²¡æœ‰è¯·æ±‚ä½“ï¼Œä¼ é€’null
}
```



## `Fetch`

`XHR`çš„é—®é¢˜ï¼š

- æ‰€æœ‰çš„åŠŸèƒ½å…¨éƒ¨é›†ä¸­åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œå®¹æ˜“ä¹¦å†™å‡ºæ··ä¹±ä¸æ˜“ç»´æŠ¤çš„ä»£ç 
- é‡‡ç”¨ä¼ ç»Ÿçš„äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼Œæ— æ³•é€‚é…æ–°çš„`Promise API`

`Fetch API`çš„ç‰¹ç‚¹

- å¹¶éå–ä»£`AJAX`ï¼Œè€Œæ˜¯å¯¹`AJAX`ä¼ ç»Ÿ`XHR API`çš„æ”¹è¿›
- ç²¾ç»†çš„åŠŸèƒ½åˆ†å‰²ï¼šå¤´éƒ¨ä¿¡æ¯ã€è¯·æ±‚ä¿¡æ¯ã€å“åº”ä¿¡æ¯ç­‰å‡åˆ†å¸ƒåˆ°ä¸åŒçš„å¯¹è±¡ï¼Œæ›´åˆ©äºå¤„ç†å„ç§å¤æ‚çš„åœºæ™¯
- ä½¿ç”¨`Promise API`ï¼Œæ›´åˆ©äºå¼‚æ­¥ä»£ç çš„ä¹¦å†™
- `Fetch API`å¹¶é`ES6`çš„å†…å®¹ï¼Œå±äº`HTML5`æ–°å¢çš„`Web API`
- `fetch()`è¿”å›çš„æ˜¯ä¸€ä¸ª`Promise`å¯¹è±¡ï¼Œå½“æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”å¤´ä¹‹åï¼Œ`Promise`å®Œæˆ 

è¯­æ³•ï¼š`fetch(url, options)`ï¼Œå…¶ä¸­`options`å¯é€‰

- `url`ï¼šæƒ³è¦è·å–çš„èµ„æºçš„åœ°å€
- `options`ï¼šè¯·æ±‚é…ç½®å¯¹è±¡ï¼Œ[å®Œæ•´é…ç½®æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/RequestInit)
  - `method`ï¼šè¯·æ±‚æ–¹å¼ï¼Œé»˜è®¤å€¼`GET`
  - `headers`ï¼šè¯·æ±‚å¤´å¯¹è±¡
  - `body`ï¼šè¯·æ±‚ä½“å†…å®¹ï¼Œæ ¼å¼å¿…é¡»å’Œè¯·æ±‚å¤´ä¸­çš„`Content-Type`çš„å€¼ä¿æŒä¸€è‡´
  - `mode`ï¼šå­—ç¬¦ä¸²ï¼Œè¯·æ±‚æ¨¡å¼
    - `same-origin`ï¼šç¦æ­¢è·¨æºè¯·æ±‚ï¼Œè¡¨ç¤ºè¯·æ±‚å¿…é¡»åœ¨åŒæºä¸­å‘ç”Ÿï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™
    - `cors`ï¼šé»˜è®¤å€¼ï¼Œè®¾ç½®ä¸ºè¯¥å€¼ï¼Œä¼šåœ¨è¯·æ±‚å¤´ä¸­åŠ å…¥`origin`å’Œ`referer`
    - `no-cors`ï¼šè®¾ç½®ä¸ºè¯¥å€¼ï¼Œä¸ä¼šåœ¨è¯·æ±‚å¤´ä¸­åŠ å…¥`origin`å’Œ`referer`ï¼Œè¯·æ±‚è·¨åŸŸæ—¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜
  - `credentials`ï¼šå¦‚ä½•æºå¸¦`cookie`å‡­è¯
    - `omit`ï¼šé»˜è®¤å€¼ï¼Œä¸æºå¸¦
    - `same-origin`ï¼šè¯·æ±‚åŒæºåœ°å€æ—¶æºå¸¦
    - `include`ï¼šä»»ä½•è¯·æ±‚åœ°å€éƒ½ä¼šæºå¸¦
  - `cache`ï¼šé…ç½®è¯·æ±‚ç¼“å­˜æ¨¡å¼
    - `default`ï¼šè¡¨ç¤º`fetch`è¯·æ±‚ä¹‹å‰å°†æ£€æŸ¥ä¸€ä¸‹`http`ç¼“å­˜
    - `no-store`ï¼šç›´æ¥ä»è¿œç¨‹æœåŠ¡å™¨è·å–èµ„æºï¼Œä¸ä¼šå…ˆæ£€æŸ¥`http`ç¼“å­˜ï¼Œå¹¶ä¸”æ‹¿åˆ°å“åº”åä¹Ÿä¸ä¼šæ›´æ–°ç¼“å­˜
    - `reload`ï¼šç›´æ¥ä»è¿œç¨‹æœåŠ¡å™¨è·å–èµ„æºï¼Œä¸ä¼šå…ˆæ£€æŸ¥`http`ç¼“å­˜ï¼Œä½†æ˜¯æ‹¿åˆ°å“åº”åä¼šæ›´æ–°ç¼“å­˜
    - `no-cache`ï¼šå¦‚æœå­˜åœ¨åŒ¹é…çš„ç¼“å­˜ï¼Ÿæ— è®ºç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œéƒ½ä¼šå‘è¿œç¨‹æœåŠ¡å™¨å‘å‡ºæ¡ä»¶è¯·æ±‚
      å¦‚æœæœåŠ¡å™¨è¡¨æ˜èµ„æºæ²¡æœ‰å˜åŒ–ï¼šå°†ä»ç¼“å­˜ä¸­è¿”å›è¯¥èµ„æºï¼Œæœ‰å˜åŒ–ï¼šä»æœåŠ¡å™¨ä¸‹è½½èµ„æºå¹¶æ›´æ–°ç¼“å­˜
      å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Ÿå‘å‡ºæ™®é€šè¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ä¸‹è½½çš„èµ„æºæ›´æ–°ç¼“å­˜
    - `force-cache`ï¼šå¦‚æœæœ‰åŒ¹é…é¡¹ç¼“å­˜ï¼Ÿæ— è®ºæ˜¯å¦è¿‡æœŸéƒ½å°†ä»ç¼“å­˜ä¸­è¿”å›
      å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Ÿå‘å‡ºæ™®é€šè¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ä¸‹è½½çš„èµ„æºæ›´æ–°ç¼“å­˜
    - `only-if-cached`ï¼šå¦‚æœæœ‰åŒ¹é…é¡¹ç¼“å­˜ï¼Ÿæ— è®ºæ˜¯å¦è¿‡æœŸéƒ½å°†ä»ç¼“å­˜ä¸­è¿”å›
      å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Ÿåˆ™è¿”å›ç½‘ç»œé”™è¯¯

### `Request`å¯¹è±¡

é™¤äº†ä½¿ç”¨åŸºæœ¬çš„`fetch`æ–¹æ³•ï¼Œè¿˜å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ª`Request`å¯¹è±¡æ¥å®Œæˆè¯·æ±‚
å®é™…ä¸Šï¼Œ`fetch`çš„å†…éƒ¨ä¼šå¸®ä½ åˆ›å»ºä¸€ä¸ª`Request`å¯¹è±¡

```js
const url = 'http://xxx.com:1234/api'
/** æ™®é€šå†™æ³• **/
fetch(url, options)

/** Request å†™æ³• **/
const req = new Request(url, options)
fetch(req)

// æ³¨æ„ï¼šå°½é‡ä¿è¯æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªæ–°çš„`Request`å¯¹è±¡
// æˆ–è€…
// ä½¿ç”¨ .clone() è·å–ä¸€ä»½å…‹éš†çš„`Request`å¯¹è±¡
req.clone()
```

### `Response`å¯¹è±¡

- `ok`ï¼šå½“å“åº”æ¶ˆæ¯ç åœ¨`200~299`ä¹‹é—´æ—¶ä¸º`true`ï¼Œå…¶ä»–ä¸º`false`
- `status`ï¼šå“åº”çŠ¶æ€ç 
- `text()`ï¼šç”¨äºå¤„ç†æ–‡æœ¬æ ¼å¼çš„å“åº”
  ä»å“åº”ä¸­è·å–æ–‡æœ¬æµå¹¶å°†å…¶è¯»å®Œï¼Œç„¶åè¿”ä¸€ä¸ªè¢«è§£å†³ä¸º`string`çš„`Promise`
- `blob()`ï¼šç”¨äºå¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ï¼ˆæ¯”å¦‚å›¾ç‰‡æˆ–è€…ç”µå­è¡¨æ ¼ï¼‰çš„å“åº”
  è¯»å–æ–‡ä»¶çš„åŸå§‹æ•°æ®ï¼Œä¸€æ—¦è¯»å–å®Œæ•´ä¸ªæ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªè¢«è§£å†³ä¸º`blob`å¯¹è±¡çš„`Promise`
- `json()`ï¼šç”¨äºå¤„ç†`JSON`æ ¼å¼çš„çš„å“åº”
  å®ƒå°†`JSON`æ•°æ®æµè½¬æ¢ä¸ºä¸€ä¸ªè¢«è§£å†³ä¸º`Javascript`å¯¹è±¡çš„`Promise`
- `redirect()`ï¼šå¯ä»¥ç”¨äºé‡å®šå‘åˆ°å¦ä¸€ä¸ªURL
  å®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„`Promise`ï¼Œä»¥è§£å†³æ¥è‡ªé‡å®šå‘çš„URLçš„å“åº”

```js
(() => {
  const response = await fetch('http://localhost:7001/api/herolist') // ç­‰å¾… å“åº”å¤´ è¿”å›
  const result = await response.json() // ç­‰å¾… å“åº”ä½“ å®Œæˆè¿”å›
  console.log(result)
})()

// ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ„å»º Response å¯¹è±¡ï¼Œç”¨äºæ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
const response = new Response(`
	{ "id": 1, "name": "åŒ—äº¬" },
	{ "id": 2, "name": "ä¸Šæµ·" },
`, {
  ok: true,
  status: 200
})
```

### `Headers`å¯¹è±¡

åœ¨`Request`å’Œ`Response`å¯¹è±¡å†…éƒ¨ï¼Œä¼šå°†ä¼ é€’çš„è¯·æ±‚å¤´å¯¹è±¡ï¼Œè½¬æ¢ä¸º`Headers`

```js
// æ„å»º headers
const headers = new Headers({
  'Content-Type': 'applocation/json',
  'custom-key': '123456'
})
const req = new Request(url, {
  headers
})
fetch(req)

// è·å– headers
// - .has(key) headers.has(key) æ£€æŸ¥è¯·æ±‚å¤´ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„keyå€¼
// - .get(key) å¾—åˆ°è¯·æ±‚å¤´ä¸­å¯¹åº”çš„keyå€¼
// - .set(key, value) ä¿®æ”¹å¯¹åº”çš„é”®å€¼å¯¹
// - .append(key, value) æ·»åŠ å¯¹åº”çš„é”®å€¼å¯¹
// - .keys() å¾—åˆ°æ‰€æœ‰çš„è¯·æ±‚å¤´é”®çš„é›†åˆ
// - .values() å¾—åˆ°æ‰€æœ‰çš„è¯·æ±‚å¤´ä¸­çš„å€¼çš„é›†åˆ
// - .entries() å¾—åˆ°æ‰€æœ‰è¯·æ±‚å¤´ä¸­çš„é”®å€¼å¯¹çš„é›†åˆ
```

